# 全自动月度数据分析脚本

## 功能简介

这是一个**完全自动化**的Python数据分析脚本，能够：

- 🤖 **自动识别**Excel文件中的维度列（文本类型）和指标列（数字类型）
- 📊 **自动执行**月度对比分析，无需手动指定列名
- 📈 **自动计算**环比增幅，智能处理除零等特殊情况
- 📄 **自动生成**格式化的Excel分析报告

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 准备数据文件

确保当前目录下有以下两个Excel文件：
- `本月数据.xlsx` - 本月的业务数据
- `上月数据.xlsx` - 上月的业务数据

### 3. 运行分析

```bash
python auto_monthly_analysis.py
```

### 4. 查看结果

脚本会自动生成 `月度分析报告_自动版.xlsx` 文件，包含：
- **月度分析报告**：详细的对比分析结果
- **分析汇总**：分析统计信息
- **列信息**：自动识别的列类型说明

## 自动化逻辑

### 列类型自动识别
- **维度列**：数据类型为 `object` 或 `category` 的列（文本类型）
- **指标列**：数据类型为 `int` 或 `float` 的列（数字类型）
- **自动排除**：ID、编号、日期等不适合分析的列

### 分析流程
1. 📖 读取本月和上月Excel数据
2. 🔍 自动识别维度列和指标列
3. 📊 按维度分组，对指标求和聚合
4. 🔗 合并本月和上月数据为宽表
5. 📈 计算每个指标的环比增幅
6. 📄 格式化结果并生成Excel报告

### 环比增幅计算
- 公式：`(本月 - 上月) / 上月`
- 特殊处理：
  - 上月为0，本月>0：标记为 ∞
  - 上月为0，本月=0：标记为 0
  - 结果格式化为百分比显示

## 自定义配置

### 排除特定列

在脚本的 `main()` 函数中修改 `EXCLUDE_COLUMNS` 列表：

```python
EXCLUDE_COLUMNS = [
    '客户编号',
    '流水号', 
    '备注',
    '创建时间'
]
```

### 修改文件路径

在 `main()` 函数中修改文件路径：

```python
CURRENT_MONTH_FILE = "本月数据.xlsx"
PREVIOUS_MONTH_FILE = "上月数据.xlsx"
```

## 示例数据格式

### 输入数据示例 (本月数据.xlsx)
| 地区 | 产品类别 | 销售额 | 订单数 | 客户ID |
|------|----------|--------|--------|--------|
| 北京 | 电子产品 | 10000  | 50     | C001   |
| 上海 | 服装     | 8000   | 40     | C002   |

### 输出报告示例
| 地区 | 产品类别 | 销售额_本月 | 销售额_上月 | 销售额_环比增幅_百分比 | 订单数_本月 | 订单数_上月 | 订单数_环比增幅_百分比 |
|------|----------|-------------|-------------|------------------------|-------------|-------------|------------------------|
| 北京 | 电子产品 | 10000       | 9000        | 11.11%                 | 50          | 45          | 11.11%                 |
| 上海 | 服装     | 8000        | 7500        | 6.67%                  | 40          | 38          | 5.26%                  |

## 技术特点

- ✅ **零配置**：无需手动指定列名，全自动识别
- ✅ **智能排除**：自动排除ID、编号等不适合分析的列
- ✅ **健壮性**：完善的错误处理和特殊值处理
- ✅ **可扩展**：支持自定义排除列和配置
- ✅ **详细日志**：完整的分析过程记录
- ✅ **多表输出**：主报告 + 汇总 + 列信息

## 依赖包说明

- `pandas`：数据处理和分析
- `numpy`：数值计算
- `openpyxl`：Excel文件读写
- `xlsxwriter`：高性能Excel写入（可选）

## 注意事项

1. **数据格式**：确保Excel文件第一行为列头
2. **数据类型**：脚本依据列的数据类型自动判断，请确保数据类型正确
3. **文件路径**：默认在当前目录查找文件，可在代码中修改路径
4. **内存使用**：大数据文件可能需要较多内存

## 疑难解答

### Q: 某些列被错误识别为维度/指标列怎么办？
A: 在 `EXCLUDE_COLUMNS` 中添加该列名，或检查列的数据类型是否正确。

### Q: 如何处理日期列？
A: 日期列通常会被自动排除，如需包含可从排除列表中移除。

### Q: 报告中出现∞值是什么意思？
A: 表示上月该项为0，本月有数值，增长率为无穷大。

### Q: 如何分析更多维度？
A: 脚本会自动识别所有文本类型列作为维度，无需额外配置。