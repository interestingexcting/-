# 📊 交互式Excel数据分析工具 V2.0

## 🎯 项目简介

这是一个升级版的智能命令行Excel数据分析工具，现在支持**双模式分析**！不仅能按维度汇总，还新增了强大的**按指标区间汇总**功能，让您的数据分析更加全面和深入。

## ✨ 核心功能

### 🔍 智能分析
- **自动列识别**: 智能区分维度列（文本）和指标列（数值）
- **日期驱动**: 根据输入日期自动查找对应的Excel文件
- **错误处理**: 完善的异常处理机制，确保程序稳定运行

### 🎮 双模式分析
- **模式一：按维度汇总**
  - 选择维度列进行分组分析
  - 计算各维度组合的指标汇总和环比
  - 适合产品线、区域等分类分析

- **🆕 模式二：按指标区间汇总**
  - 选择指标列进行区间划分
  - 分析不同数值区间的数据分布
  - 智能环比计算和区间对比
  - 适合金额、数量等连续变量分析

### 📈 环比分析
- 自动计算月度环比增长率和变化量
- 智能处理分母为0和数据缺失情况
- 详细的统计摘要和趋势分析

## 📋 系统要求

- Python 3.6+
- pandas
- openpyxl
- numpy

## 🚀 快速开始

### 1. 安装依赖

```bash
# Ubuntu/Debian系统
sudo apt update
sudo apt install python3-pandas python3-openpyxl python3-numpy

# 或使用pip（如果允许）
pip3 install pandas openpyxl numpy
```

### 2. 准备数据文件

确保您的Excel文件遵循以下命名规则：
```
数据_YYYY-MM-DD.xlsx
```

例如：
- `数据_2023-10-31.xlsx` (本月数据)
- `数据_2023-09-30.xlsx` (上月数据)

### 3. 运行分析工具

```bash
python3 data_analyzer_v2.py
```

### 4. 使用示例

#### 模式一：按维度汇总
```
1. 输入本月末日期: 2023-10-31
2. 输入上月末日期: 2023-09-30
3. 选择分析模式: 1
4. 选择分析维度: 1,2 (选择产品线和所属区域)
5. 查看分析结果
```

#### 🆕 模式二：按指标区间汇总
```
1. 输入本月末日期: 2023-10-31
2. 输入上月末日期: 2023-09-30
3. 选择分析模式: 2
4. 选择指标列: 2 (选择贷款金额)
5. 输入切分点: 500000,1500000
6. 查看按区间汇总的分析结果
```

## 📊 数据格式要求

### Excel文件结构示例

| 产品线 | 所属区域 | 风险等级 | 风险金额 | 贷款金额 | 风险笔数 | 客户数量 | 收入金额 |
|--------|----------|----------|----------|----------|----------|----------|----------|
| 产品线A | 华东区   | 低风险   | 125000.50| 850000.00| 25       | 18       | 75000.00 |
| 产品线B | 华南区   | 中风险   | 89000.00 | 320000.00| 12       | 35       | 45000.00 |

### 列类型识别规则

- **维度列（Dimension）**: 文本类型数据，用于分组分析
  - 数据类型：`object`, `string`
  - 示例：产品线、区域、等级等

- **指标列（Metric）**: 数值类型数据，用于汇总计算
  - 数据类型：`int64`, `float64`, `int32`, `float32`
  - 示例：金额、数量、笔数等

## 🆕 区间分析详解

### 区间切分方式

1. **单切分点**: `500000`
   - 创建区间：`<=500000`, `>500000`

2. **双切分点**: `100000,500000`
   - 创建区间：`<=100000`, `100000-500000`, `>500000`

3. **多切分点**: `100000,500000,1500000`
   - 创建区间：`<=100000`, `100000-500000`, `500000-1500000`, `>1500000`

### 区间分析应用场景

- **贷款金额分析**: 小额、中额、大额贷款的风险分布
- **客户分层**: 按收入或资产进行客户分层分析
- **产品定价**: 不同价格区间的销售表现
- **风险管理**: 按风险金额区间的风险分布

## 🔧 测试工具

项目包含完整的测试套件：

### 生成测试数据
```bash
python3 create_test_data_v2.py
```

选择操作：
1. 生成新的测试数据（包含更丰富的数值范围）
2. 分析现有数据分布

## 📈 输出结果示例

### 按维度汇总结果
```
================================================================================
📈 按维度汇总分析结果
================================================================================
 产品线  所属区域  风险金额_上月  风险金额_本月  风险金额_变化  风险金额_环比(%)  ...
产品线A   华东区   2640684.26   1419765.24  -1220919.02        -46.23     ...
产品线A   华北区   2941708.03    779605.53  -2162102.50        -73.50     ...
```

### 🆕 按指标区间汇总结果
```
================================================================================
📈 按指标区间汇总分析结果
================================================================================
      区间         风险金额_上月      风险金额_本月       风险金额_变化  风险金额_环比(%)  ...
  <=500000       52457831.18       70764730.00       18306898.82            34.90   ...
500000-1500000   26529998.13       18832500.00       -7697498.13           -29.01   ...
  >1500000       30896986.26       40510310.00        9613323.74            31.11   ...
================================================================================
📊 数据汇总信息:
   总分组数: 3
   风险金额_环比(%): 增长(2) | 下降(1) | 持平(0)
================================================================================
```

## 🛠️ 高级功能

### 智能区间建议
- 程序会分析数据分布，显示最小值、最大值、中位数等统计信息
- 提供基于四分位数的区间切分建议
- 支持用户自定义任意数量的切分点

### 环比计算增强
- 处理区间新增或消失的情况
- 智能处理分母为0的环比计算
- 提供详细的增长趋势统计

### 结果保存
程序会根据分析模式自动生成带标识的文件名：
- `分析结果_维度汇总_2023-10-31_vs_2023-09-30.xlsx`
- `分析结果_区间汇总_2023-10-31_vs_2023-09-30.xlsx`

## 📁 项目文件结构

```
├── data_analyzer_v2.py         # 主程序文件（V2.0版本）
├── create_test_data_v2.py      # 增强版测试数据生成器
├── README_V2.md               # V2.0版本说明文档
├── 数据_2023-09-30.xlsx        # 示例上月数据（增强版）
└── 数据_2023-10-31.xlsx        # 示例本月数据（增强版）
```

## 🆚 版本对比

| 功能 | V1.0 | V2.0 |
|------|------|------|
| 按维度汇总 | ✅ | ✅ |
| 按指标区间汇总 | ❌ | ✅ |
| 模式选择菜单 | ❌ | ✅ |
| 区间分析 | ❌ | ✅ |
| pd.cut()分箱 | ❌ | ✅ |
| 多层切分点 | ❌ | ✅ |
| 智能区间建议 | ❌ | ✅ |

## 🐛 常见问题

### Q: 如何选择合适的切分点？
A: 
1. 查看程序提供的数据分布统计
2. 使用中位数作为单切分点
3. 使用25%、75%分位数作为双切分点
4. 根据业务需求设定特定阈值

### Q: 区间分析适合什么类型的数据？
A: 适合连续数值变量，如：
- 金额类指标（贷款金额、收入金额等）
- 数量类指标（客户数量、订单数量等）
- 评分类指标（信用评分、满意度等）

### Q: 某个区间在上月不存在怎么办？
A: 程序会自动处理，将缺失区间的上月数据填充为0，环比计算会显示为100%增长。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个工具！

特别欢迎以下类型的贡献：
- 新的分析模式
- 更多的统计功能
- 可视化图表支持
- 性能优化

## 📄 许可证

MIT License

---

**体验双模式分析的强大功能！** 🎉